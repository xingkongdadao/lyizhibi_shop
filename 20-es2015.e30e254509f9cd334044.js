(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{H4Gf:function(e,t,o){"use strict";o.r(t),o.d(t,"MapPageModule",(function(){return m}));var r=o("tyNb"),a=o("mrSG"),s=o("4ZJM"),i=o("AytR"),n=o("LLYR"),c=o("fXoL"),l=o("1jKG"),h=o("njxG"),p=o("WC10"),d=o("TEn/");const b=[{path:"",component:(()=>{class e{constructor(e,t,o,r){this.shopService=e,this.shopCategoryListService$=t,this.shopAreaListService$=o,this.modalController=r,this.colorType="area",this.shopMarkers=[],this.pageSize=1e4,this.pageIndex=1,this.hidden=!0,this.originalMarker=new s.Marker({draggable:!1,color:"blue"}),this.locationMarker=new s.Marker({draggable:!0,color:"blue"}),this.selectedMarker=new s.Marker({draggable:!0,color:"red"}),this.streetsMapStyle="mapbox://styles/mapbox/streets-v11",this.satelliteMapStyle="mapbox://styles/mapbox/satellite-v9",this.lightMapStyle="mapbox://styles/mapbox/light-v10",this.darkMapStyle="mapbox://styles/mapbox/dark-v10",this.outdoorsMapStyle="mapbox://styles/mapbox/outdoors-v11"}ngOnInit(){}ionViewWillEnter(){s.accessToken=i.a.mapboxKey,this.shopService.getShopDryList().subscribe(e=>{this.shopDryList=e.results}),this.shopService.getPdShopList().subscribe(e=>{this.pdShopList=e.results,this.initMapBox(),this.mapLoad(),this.hidden=!1,this.mapClick(),this.length=e.count}),this.shopCategoryListService$.getShopCategoryList().subscribe(e=>{this.shopCategoryList=e.results}),this.shopAreaListService$.getShopAreaList().subscribe(e=>{this.shopAreaList=e.results})}initMapBox(){this.map=new s.Map({container:"mapa-mapbox",style:this.streetsMapStyle,center:[-122.49378204345702,37.83368330777276],bearing:0,zoom:15})}mapClick(){this.map.on("touchend",e=>{this.selectedMarker.remove(),this.selectedMarker.setLngLat(e.lngLat).addTo(this.map),this.presentModal().then()})}markerAllShopLocation(e){e.name.every((t,o,r)=>(this.creatMarkerByShop({name:t,code:e.code[o],latitude:e.latitude[o],longitude:e.longitude[o],shopCategoryColor:e.shop_category__color[o],shopAreaColor:e.shop_area__color[o],shopLevelColor:e.shopLevel__color[o],shopCityColor:e.city__color[o]},this.colorType),!0))}creatMarkerByShop(e,t="area"){const o=document.createElement("div");switch(o.className="marker1",o.style.width="18px",o.style.height="18px",o.style.borderRadius="9px",o.style.backgroundImage="circle-15.svg",o.align="center",t){case"category":o.style.backgroundColor=e.shopCategoryColor;break;case"area":o.style.backgroundColor=e.shopAreaColor;break;case"level":o.style.backgroundColor=e.shopLevelColor;break;default:o.style.backgroundColor=e.shopAreaColor}const r=new s.Popup({offset:25}).setText(e.name+e.code),a=new s.Marker({element:o,draggable:!1,color:"blue"}).setLngLat([e.longitude,e.latitude]).setPopup(r).addTo(this.map);this.shopMarkers.push(a),o.addEventListener("click",()=>{})}switchLayer(e){this.map.setStyle(e),console.log(e)}getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{this.locationMarker.setLngLat([e.coords.longitude,e.coords.latitude]),this.creatUserLocationMarker()}):alert("\u7528\u6237\u4e0d\u5141\u8bb8\u83b7\u53d6\u624b\u673a\u5b9a\u4f4d")}creatUserLocationMarker(){this.locationMarker.addTo(this.map),this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat]),this.timer=setInterval(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{this.locationMarker.remove(),this.locationMarker.setLngLat([e.coords.longitude,e.coords.latitude]).addTo(this.map)})},1e3)}ngOnDestroy(){this.timer&&clearInterval(this.timer)}resetBearing(){this.map.setBearing(0)}resetLocation(){this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat])}presentModal(){return Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:n.a,cssClass:"my-custom-class",componentProps:{shopCategoryList:this.shopCategoryList,shopAreaList:this.shopAreaList,selectedMarker:this.selectedMarker}});yield e.present();const t=yield e.onDidDismiss();t.data.shop&&this.shopService.getShopList(1,1,"","",t.data.shop.code).subscribe(e=>{this.shopAdd=e.results[0],this.creatMarkerByShop(this.shopAdd)})}))}refreshShop(e){this.colorType=e,this.selectedMarker.remove(),this.shopService.getPdShopList().subscribe(e=>{this.removeShopMarker(),this.pdShopList=e.results,this.hidden=!1,this.markerAllShopLocation(this.pdShopList)})}removeShopMarker(){this.shopMarkers.forEach(e=>e.remove()),this.shopMarkers=[]}mapLoad(){this.map.on("load",()=>{this.map.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[-122.48369693756104,37.83381888486939],[-122.48348236083984,37.83317489144141],[-122.48339653015138,37.83270036637107],[-122.48356819152832,37.832056363179625],[-122.48404026031496,37.83114119107971],[-122.48404026031496,37.83049717427869],[-122.48348236083984,37.829920943955045],[-122.48356819152832,37.82954808664175],[-122.48507022857666,37.82944639795659],[-122.48610019683838,37.82880236636284],[-122.48695850372314,37.82931081282506],[-122.48700141906738,37.83080223556934],[-122.48751640319824,37.83168351665737],[-122.48803138732912,37.832158048267786],[-122.48888969421387,37.83297152392784],[-122.48987674713133,37.83263257682617],[-122.49043464660643,37.832937629287755],[-122.49125003814696,37.832429207817725],[-122.49163627624512,37.832564787218985],[-122.49223709106445,37.83337825839438],[-122.49378204345702,37.83368330777276]]}}}),this.map.addLayer({id:"route",type:"circle",source:"route",paint:{"circle-radius":10,"circle-opacity":.5,"circle-stroke-width":2,"circle-stroke-color":"red","circle-stroke-opacity":1}})})}}return e.\u0275fac=function(t){return new(t||e)(c.Ib(l.a),c.Ib(h.a),c.Ib(p.a),c.Ib(d.B))},e.\u0275cmp=c.Cb({type:e,selectors:[["app-map"]],decls:36,vars:3,consts:[["slot","start"],["autoHide","false","color","danger"],["id","mapa-mapbox"],["id","menu",3,"hidden"],["id","streets-v11","type","radio","name","rtoggle","value","streets","checked","checked",3,"change"],["for","streets-v11"],["id","light-v10","type","radio","name","rtoggle","value","light",3,"change"],["for","light-v10"],["id","dark-v10","type","radio","name","rtoggle","value","dark",3,"change"],["for","dark-v10"],["id","outdoors-v11","type","radio","name","rtoggle","value","outdoors",3,"change"],["for","outdoors-v11"],["id","satellite-v9","type","radio","name","rtoggle","value","satellite",3,"change"],["for","satellite-v9"],["id","bearing",3,"hidden"],[3,"click"],["id","location",3,"hidden"],["name","compass"]],template:function(e,t){1&e&&(c.Lb(0,"ion-header"),c.Lb(1,"ion-toolbar"),c.Lb(2,"ion-buttons",0),c.Jb(3,"ion-menu-button",1),c.Kb(),c.Lb(4,"ion-title"),c.dc(5,"\u6240\u6709\u5e97\u94fa\u5206\u5e03"),c.Kb(),c.Kb(),c.Kb(),c.Lb(6,"ion-content"),c.Jb(7,"div",2),c.Lb(8,"div",3),c.Lb(9,"input",4),c.Sb("change",(function(){return t.switchLayer(t.streetsMapStyle)})),c.Kb(),c.Lb(10,"label",5),c.dc(11,"streets"),c.Kb(),c.Lb(12,"input",6),c.Sb("change",(function(){return t.switchLayer(t.lightMapStyle)})),c.Kb(),c.Lb(13,"label",7),c.dc(14,"light"),c.Kb(),c.Lb(15,"input",8),c.Sb("change",(function(){return t.switchLayer(t.darkMapStyle)})),c.Kb(),c.Lb(16,"label",9),c.dc(17,"dark"),c.Kb(),c.Lb(18,"input",10),c.Sb("change",(function(){return t.switchLayer(t.outdoorsMapStyle)})),c.Kb(),c.Lb(19,"label",11),c.dc(20,"outdoors"),c.Kb(),c.Lb(21,"input",12),c.Sb("change",(function(){return t.switchLayer(t.satelliteMapStyle)})),c.Kb(),c.Lb(22,"label",13),c.dc(23,"satellite"),c.Kb(),c.Kb(),c.Lb(24,"div",14),c.Lb(25,"ion-fab-button",15),c.Sb("click",(function(){return t.resetBearing()})),c.dc(26,"\u5317"),c.Kb(),c.Kb(),c.Lb(27,"div",16),c.Lb(28,"ion-fab-button",15),c.Sb("click",(function(){return t.resetLocation()})),c.Jb(29,"ion-icon",17),c.Kb(),c.Lb(30,"ion-button",15),c.Sb("click",(function(){return t.refreshShop("category")})),c.dc(31,"\u7c7b\u578b"),c.Kb(),c.Lb(32,"ion-button",15),c.Sb("click",(function(){return t.refreshShop("area")})),c.dc(33,"\u533a\u57df"),c.Kb(),c.Lb(34,"ion-button",15),c.Sb("click",(function(){return t.refreshShop("level")})),c.dc(35,"\u7ea7\u522b"),c.Kb(),c.Kb(),c.Kb()),2&e&&(c.yb(8),c.Yb("hidden",t.hidden),c.yb(16),c.Yb("hidden",t.hidden),c.yb(3),c.Yb("hidden",t.hidden))},directives:[d.h,d.y,d.d,d.o,d.w,d.f,d.g,d.i,d.c],styles:["#mapa-mapbox[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%;height:100%}#menu[_ngcontent-%COMP%]{background:#fff;padding:10px;font-family:Open Sans,sans-serif}#bearing[_ngcontent-%COMP%], #menu[_ngcontent-%COMP%]{position:absolute}#bearing[_ngcontent-%COMP%]{margin-top:300px}#location[_ngcontent-%COMP%]{position:absolute;margin-top:400px}.my-custom-class[_ngcontent-%COMP%]{--background:#222}"]}),e})()}];let g=(()=>{class e{}return e.\u0275mod=c.Gb({type:e}),e.\u0275inj=c.Fb({factory:function(t){return new(t||e)},imports:[[r.i.forChild(b)],r.i]}),e})();var u=o("kCW2");let m=(()=>{class e{}return e.\u0275mod=c.Gb({type:e}),e.\u0275inj=c.Fb({factory:function(t){return new(t||e)},imports:[[u.a,g]]}),e})()}}]);