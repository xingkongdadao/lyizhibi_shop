!function(){function e(e,n){var o;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(o=function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return t(e,n)}(e))||n&&e&&"number"==typeof e.length){o&&(e=o);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==o.return||o.return()}finally{if(c)throw i}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{VXaA:function(t,r,a){"use strict";a.r(r),a.d(r,"MapPageModule",(function(){return M}));var i,s,c,l=a("tyNb"),u=a("mrSG"),h=a("4ZJM"),p=a("AytR"),d=a("LLYR"),b=a("fXoL"),g=a("1jKG"),f=a("njxG"),y=a("WC10"),m=a("TEn/"),v=[{path:"",component:(i=function(){function t(e,o,r,a){n(this,t),this.shopService=e,this.shopCategoryListService$=o,this.shopAreaListService$=r,this.modalController=a,this.shopMarkers=[],this.pageSize=1e4,this.pageIndex=1,this.hidden=!0,this.locationMarker=new h.Marker({draggable:!0,color:"blue"}),this.selectedMarker=new h.Marker({draggable:!0,color:"red"}),this.streetsMapStyle="mapbox://styles/mapbox/streets-v11",this.satelliteMapStyle="mapbox://styles/mapbox/satellite-v9",this.lightMapStyle="mapbox://styles/mapbox/light-v10",this.darkMapStyle="mapbox://styles/mapbox/dark-v10",this.outdoorsMapStyle="mapbox://styles/mapbox/outdoors-v11"}var r,a,i;return r=t,(a=[{key:"ngOnInit",value:function(){var e=this;h.accessToken=p.a.mapboxKey,this.shopService.getShopList(this.pageIndex,this.pageSize).subscribe((function(t){e.shopsIncludeCategory=t.results,e.hidden=!1,e.initMapBox(),e.getUserLocation(),e.length=t.count,e.markerAllShopLocation(e.shopsIncludeCategory)})),this.shopCategoryListService$.getShopCategoryList().subscribe((function(t){e.shopCategoryList=t.results})),this.shopAreaListService$.getShopAreaList().subscribe((function(t){e.shopAreaList=t.results}))}},{key:"initMapBox",value:function(){this.map=new h.Map({container:"mapa-mapbox",style:this.streetsMapStyle,center:[104.9001643,11.5447752],bearing:0,zoom:11})}},{key:"mapClick",value:function(){var e=this;this.map.on("click",(function(t){e.selectedMarker.remove(),e.selectedMarker.setLngLat(t.lngLat).addTo(e.map),e.presentModal().then()}))}},{key:"markerAllShopLocation",value:function(t){var n,o=e(t);try{for(o.s();!(n=o.n()).done;){var r=n.value;this.creatMarkerByShop(r)}}catch(a){o.e(a)}finally{o.f()}}},{key:"creatMarkerByShop",value:function(e){var t=document.createElement("div");t.className="marker1",t.style.width="18px",t.style.height="18px",t.style.borderRadius="9px",t.style.backgroundColor=e.shop_category.color,t.style.backgroundImage="circle-15.svg",t.align="center";var n=new h.Popup({offset:25}).setText(e.name+e.code),o=new h.Marker({element:t,draggable:!1,color:"blue"}).setLngLat([e.longitude,e.latitude]).setPopup(n).addTo(this.map);this.shopMarkers.push(o),t.addEventListener("click",(function(){}))}},{key:"switchLayer",value:function(e){this.map.setStyle(e),console.log(e)}},{key:"getUserLocation",value:function(){var e=this;navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){e.locationMarker.setLngLat([t.coords.longitude,t.coords.latitude]),e.creatUserLocationMarker()})):alert("\u7528\u6237\u4e0d\u5141\u8bb8\u83b7\u53d6\u624b\u673a\u5b9a\u4f4d")}},{key:"creatUserLocationMarker",value:function(){var e=this;this.locationMarker.addTo(this.map),this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat]),this.timer=setInterval((function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(t){e.locationMarker.remove(),e.locationMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(e.map)}))}),1e3)}},{key:"ngOnDestroy",value:function(){this.timer&&clearInterval(this.timer)}},{key:"resetBearing",value:function(){this.map.setBearing(0)}},{key:"resetLocation",value:function(){this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat])}},{key:"presentModal",value:function(){return Object(u.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:d.a,cssClass:"my-custom-class",componentProps:{shopCategoryList:this.shopCategoryList,shopAreaList:this.shopAreaList,selectedMarker:this.selectedMarker}});case 2:return t=e.sent,e.next=5,t.present();case 5:return e.next=7,t.onDidDismiss();case 7:(n=e.sent).data.shop&&this.shopService.getShopList(1,1,"","",n.data.shop.code).subscribe((function(e){o.shopAdd=e.results[0],o.creatMarkerByShop(o.shopAdd)}));case 9:case"end":return e.stop()}}),e,this)})))}},{key:"refreshShop",value:function(){var t=this;this.selectedMarker.remove(),this.shopService.getShopList(this.pageIndex,this.pageSize).subscribe((function(n){t.removeShopMarker(),t.shopsIncludeCategory=n.results,t.hidden=!1;var o,r=e(t.shopsIncludeCategory);try{for(r.s();!(o=r.n()).done;){var a=o.value;t.creatMarkerByShop(a)}}catch(i){r.e(i)}finally{r.f()}}))}},{key:"removeShopMarker",value:function(){this.shopMarkers.forEach((function(e){return e.remove()})),this.shopMarkers=[]}}])&&o(r.prototype,a),i&&o(r,i),t}(),i.\u0275fac=function(e){return new(e||i)(b.Ib(g.a),b.Ib(f.a),b.Ib(y.a),b.Ib(m.B))},i.\u0275cmp=b.Cb({type:i,selectors:[["app-map"]],decls:30,vars:3,consts:[["id","mapa-mapbox"],["id","menu",3,"hidden"],["id","streets-v11","type","radio","name","rtoggle","value","streets","checked","checked",3,"change"],["for","streets-v11"],["id","light-v10","type","radio","name","rtoggle","value","light",3,"change"],["for","light-v10"],["id","dark-v10","type","radio","name","rtoggle","value","dark",3,"change"],["for","dark-v10"],["id","outdoors-v11","type","radio","name","rtoggle","value","outdoors",3,"change"],["for","outdoors-v11"],["id","satellite-v9","type","radio","name","rtoggle","value","satellite",3,"change"],["for","satellite-v9"],["id","bearing",3,"hidden"],[3,"click"],["id","location",3,"hidden"]],template:function(e,t){1&e&&(b.Lb(0,"ion-header"),b.Lb(1,"ion-toolbar"),b.Lb(2,"ion-title"),b.dc(3,"\u4e00\u652f\u7b14\u996e\u6599\u5206\u5e03\u56fe"),b.Kb(),b.Kb(),b.Kb(),b.Lb(4,"ion-content"),b.Jb(5,"div",0),b.Lb(6,"div",1),b.Lb(7,"input",2),b.Sb("change",(function(){return t.switchLayer(t.streetsMapStyle)})),b.Kb(),b.Lb(8,"label",3),b.dc(9,"streets"),b.Kb(),b.Lb(10,"input",4),b.Sb("change",(function(){return t.switchLayer(t.lightMapStyle)})),b.Kb(),b.Lb(11,"label",5),b.dc(12,"light"),b.Kb(),b.Lb(13,"input",6),b.Sb("change",(function(){return t.switchLayer(t.darkMapStyle)})),b.Kb(),b.Lb(14,"label",7),b.dc(15,"dark"),b.Kb(),b.Lb(16,"input",8),b.Sb("change",(function(){return t.switchLayer(t.outdoorsMapStyle)})),b.Kb(),b.Lb(17,"label",9),b.dc(18,"outdoors"),b.Kb(),b.Lb(19,"input",10),b.Sb("change",(function(){return t.switchLayer(t.satelliteMapStyle)})),b.Kb(),b.Lb(20,"label",11),b.dc(21,"satellite"),b.Kb(),b.Kb(),b.Lb(22,"div",12),b.Lb(23,"ion-fab-button",13),b.Sb("click",(function(){return t.resetBearing()})),b.dc(24,"\u5317"),b.Kb(),b.Kb(),b.Lb(25,"div",14),b.Lb(26,"ion-fab-button",13),b.Sb("click",(function(){return t.resetLocation()})),b.dc(27,"\u4f4d\u7f6e"),b.Kb(),b.Lb(28,"ion-button",13),b.Sb("click",(function(){return t.refreshShop()})),b.dc(29,"\u5237\u65b0"),b.Kb(),b.Kb(),b.Kb()),2&e&&(b.yb(6),b.Yb("hidden",t.hidden),b.yb(16),b.Yb("hidden",t.hidden),b.yb(3),b.Yb("hidden",t.hidden))},directives:[m.h,m.y,m.w,m.f,m.g,m.c],styles:["#mapa-mapbox[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%;height:100%}#menu[_ngcontent-%COMP%]{background:#fff;padding:10px;font-family:Open Sans,sans-serif}#bearing[_ngcontent-%COMP%], #menu[_ngcontent-%COMP%]{position:absolute}#bearing[_ngcontent-%COMP%]{margin-top:300px}#location[_ngcontent-%COMP%]{position:absolute;margin-top:400px}.my-custom-class[_ngcontent-%COMP%]{--background:#222}"]}),i)}],k=((s=function e(){n(this,e)}).\u0275mod=b.Gb({type:s}),s.\u0275inj=b.Fb({factory:function(e){return new(e||s)},imports:[[l.i.forChild(v)],l.i]}),s),L=a("kCW2"),M=((c=function e(){n(this,e)}).\u0275mod=b.Gb({type:c}),c.\u0275inj=b.Fb({factory:function(e){return new(e||c)},imports:[[L.a,k]]}),c)}}])}();