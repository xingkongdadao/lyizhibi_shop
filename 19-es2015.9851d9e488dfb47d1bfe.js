(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{VXaA:function(e,t,o){"use strict";o.r(t),o.d(t,"MapPageModule",(function(){return m}));var s=o("tyNb"),a=o("mrSG"),i=o("4ZJM"),r=o("AytR"),n=o("LLYR"),c=o("fXoL"),h=o("1jKG"),l=o("njxG"),d=o("WC10"),p=o("TEn/");const b=[{path:"",component:(()=>{class e{constructor(e,t,o,s){this.shopService=e,this.shopCategoryListService$=t,this.shopAreaListService$=o,this.modalController=s,this.shopMarkers=[],this.pageSize=1e4,this.pageIndex=1,this.hidden=!0,this.locationMarker=new i.Marker({draggable:!0,color:"blue"}),this.selectedMarker=new i.Marker({draggable:!0,color:"red"}),this.streetsMapStyle="mapbox://styles/mapbox/streets-v11",this.satelliteMapStyle="mapbox://styles/mapbox/satellite-v9",this.lightMapStyle="mapbox://styles/mapbox/light-v10",this.darkMapStyle="mapbox://styles/mapbox/dark-v10",this.outdoorsMapStyle="mapbox://styles/mapbox/outdoors-v11"}ngOnInit(){i.accessToken=r.a.mapboxKey,this.shopService.getShopList(this.pageIndex,this.pageSize).subscribe(e=>{this.shopsIncludeCategory=e.results,this.hidden=!1,this.initMapBox(),this.getUserLocation(),this.length=e.count,this.markerAllShopLocation(this.shopsIncludeCategory)}),this.shopCategoryListService$.getShopCategoryList().subscribe(e=>{this.shopCategoryList=e.results}),this.shopAreaListService$.getShopAreaList().subscribe(e=>{this.shopAreaList=e.results})}initMapBox(){this.map=new i.Map({container:"mapa-mapbox",style:this.streetsMapStyle,center:[104.9001643,11.5447752],bearing:0,zoom:11})}mapClick(){this.map.on("click",e=>{this.selectedMarker.remove(),this.selectedMarker.setLngLat(e.lngLat).addTo(this.map),this.presentModal().then()})}markerAllShopLocation(e){for(const t of e)this.creatMarkerByShop(t)}creatMarkerByShop(e){const t=document.createElement("div");t.className="marker1",t.style.width="18px",t.style.height="18px",t.style.borderRadius="9px",t.style.backgroundColor=e.shop_category.color,t.style.backgroundImage="circle-15.svg",t.align="center";const o=new i.Popup({offset:25}).setText(e.name+e.code),s=new i.Marker({element:t,draggable:!1,color:"blue"}).setLngLat([e.longitude,e.latitude]).setPopup(o).addTo(this.map);this.shopMarkers.push(s),t.addEventListener("click",()=>{})}switchLayer(e){this.map.setStyle(e),console.log(e)}getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{this.locationMarker.setLngLat([e.coords.longitude,e.coords.latitude]),this.creatUserLocationMarker()}):alert("\u7528\u6237\u4e0d\u5141\u8bb8\u83b7\u53d6\u624b\u673a\u5b9a\u4f4d")}creatUserLocationMarker(){this.locationMarker.addTo(this.map),this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat]),this.timer=setInterval(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{this.locationMarker.remove(),this.locationMarker.setLngLat([e.coords.longitude,e.coords.latitude]).addTo(this.map)})},1e3)}ngOnDestroy(){this.timer&&clearInterval(this.timer)}resetBearing(){this.map.setBearing(0)}resetLocation(){this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat])}presentModal(){return Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:n.a,cssClass:"my-custom-class",componentProps:{shopCategoryList:this.shopCategoryList,shopAreaList:this.shopAreaList,selectedMarker:this.selectedMarker}});yield e.present();const t=yield e.onDidDismiss();t.data.shop&&this.shopService.getShopList(1,1,"","",t.data.shop.code).subscribe(e=>{this.shopAdd=e.results[0],this.creatMarkerByShop(this.shopAdd)})}))}refreshShop(){this.selectedMarker.remove(),this.shopService.getShopList(this.pageIndex,this.pageSize).subscribe(e=>{this.removeShopMarker(),this.shopsIncludeCategory=e.results,this.hidden=!1;for(const t of this.shopsIncludeCategory)this.creatMarkerByShop(t)})}removeShopMarker(){this.shopMarkers.forEach(e=>e.remove()),this.shopMarkers=[]}}return e.\u0275fac=function(t){return new(t||e)(c.Ib(h.a),c.Ib(l.a),c.Ib(d.a),c.Ib(p.B))},e.\u0275cmp=c.Cb({type:e,selectors:[["app-map"]],decls:30,vars:3,consts:[["id","mapa-mapbox"],["id","menu",3,"hidden"],["id","streets-v11","type","radio","name","rtoggle","value","streets","checked","checked",3,"change"],["for","streets-v11"],["id","light-v10","type","radio","name","rtoggle","value","light",3,"change"],["for","light-v10"],["id","dark-v10","type","radio","name","rtoggle","value","dark",3,"change"],["for","dark-v10"],["id","outdoors-v11","type","radio","name","rtoggle","value","outdoors",3,"change"],["for","outdoors-v11"],["id","satellite-v9","type","radio","name","rtoggle","value","satellite",3,"change"],["for","satellite-v9"],["id","bearing",3,"hidden"],[3,"click"],["id","location",3,"hidden"]],template:function(e,t){1&e&&(c.Lb(0,"ion-header"),c.Lb(1,"ion-toolbar"),c.Lb(2,"ion-title"),c.dc(3,"\u4e00\u652f\u7b14\u996e\u6599\u5206\u5e03\u56fe"),c.Kb(),c.Kb(),c.Kb(),c.Lb(4,"ion-content"),c.Jb(5,"div",0),c.Lb(6,"div",1),c.Lb(7,"input",2),c.Sb("change",(function(){return t.switchLayer(t.streetsMapStyle)})),c.Kb(),c.Lb(8,"label",3),c.dc(9,"streets"),c.Kb(),c.Lb(10,"input",4),c.Sb("change",(function(){return t.switchLayer(t.lightMapStyle)})),c.Kb(),c.Lb(11,"label",5),c.dc(12,"light"),c.Kb(),c.Lb(13,"input",6),c.Sb("change",(function(){return t.switchLayer(t.darkMapStyle)})),c.Kb(),c.Lb(14,"label",7),c.dc(15,"dark"),c.Kb(),c.Lb(16,"input",8),c.Sb("change",(function(){return t.switchLayer(t.outdoorsMapStyle)})),c.Kb(),c.Lb(17,"label",9),c.dc(18,"outdoors"),c.Kb(),c.Lb(19,"input",10),c.Sb("change",(function(){return t.switchLayer(t.satelliteMapStyle)})),c.Kb(),c.Lb(20,"label",11),c.dc(21,"satellite"),c.Kb(),c.Kb(),c.Lb(22,"div",12),c.Lb(23,"ion-fab-button",13),c.Sb("click",(function(){return t.resetBearing()})),c.dc(24,"\u5317"),c.Kb(),c.Kb(),c.Lb(25,"div",14),c.Lb(26,"ion-fab-button",13),c.Sb("click",(function(){return t.resetLocation()})),c.dc(27,"\u4f4d\u7f6e"),c.Kb(),c.Lb(28,"ion-button",13),c.Sb("click",(function(){return t.refreshShop()})),c.dc(29,"\u5237\u65b0"),c.Kb(),c.Kb(),c.Kb()),2&e&&(c.yb(6),c.Yb("hidden",t.hidden),c.yb(16),c.Yb("hidden",t.hidden),c.yb(3),c.Yb("hidden",t.hidden))},directives:[p.h,p.y,p.w,p.f,p.g,p.c],styles:["#mapa-mapbox[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%;height:100%}#menu[_ngcontent-%COMP%]{background:#fff;padding:10px;font-family:Open Sans,sans-serif}#bearing[_ngcontent-%COMP%], #menu[_ngcontent-%COMP%]{position:absolute}#bearing[_ngcontent-%COMP%]{margin-top:300px}#location[_ngcontent-%COMP%]{position:absolute;margin-top:400px}.my-custom-class[_ngcontent-%COMP%]{--background:#222}"]}),e})()}];let g=(()=>{class e{}return e.\u0275mod=c.Gb({type:e}),e.\u0275inj=c.Fb({factory:function(t){return new(t||e)},imports:[[s.i.forChild(b)],s.i]}),e})();var u=o("kCW2");let m=(()=>{class e{}return e.\u0275mod=c.Gb({type:e}),e.\u0275inj=c.Fb({factory:function(t){return new(t||e)},imports:[[u.a,g]]}),e})()}}]);