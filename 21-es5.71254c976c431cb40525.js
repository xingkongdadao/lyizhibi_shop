!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{tCC3:function(o,a,r){"use strict";r.r(a),r.d(a,"MapPageModule",(function(){return v}));var n,i,s,l=r("tyNb"),c=r("4ZJM"),b=r("AytR"),p=r("fXoL"),h=r("1jKG"),d=r("njxG"),u=r("WC10"),g=r("TEn/"),y=r("sYmb"),m=[{path:"",component:(n=function(){function o(t,a,r,n,i){e(this,o),this.shopService=t,this.shopCategoryListService$=a,this.shopAreaListService$=r,this.modalController=n,this.translate=i,this.colorType="area",this.shopMarkers=[],this.pageSize=1e4,this.pageIndex=1,this.hidden=!0,this.originalMarker=new c.Marker({draggable:!1,color:"blue"}),this.locationMarker=new c.Marker({draggable:!0,color:"blue"}),this.selectedMarker=new c.Marker({draggable:!0,color:"red"}),this.streetsMapStyle="mapbox://styles/mapbox/streets-v11",this.satelliteMapStyle="mapbox://styles/mapbox/satellite-v9",this.lightMapStyle="mapbox://styles/mapbox/light-v10",this.darkMapStyle="mapbox://styles/mapbox/dark-v10",this.outdoorsMapStyle="mapbox://styles/mapbox/outdoors-v11"}var a,r,n;return a=o,(r=[{key:"ngOnInit",value:function(){var e=this;c.accessToken=b.a.mapboxKey,this.shopService.getPdShopSellCountList().subscribe((function(t){e.pdShopList=t.results,e.hidden=!1,e.initMapBox(),e.originalMarker.remove(),e.getUserLocation(),e.length=t.count,e.removeShopMarker(),e.markerAllShopLocation(e.pdShopList)})),this.shopCategoryListService$.getShopCategoryList().subscribe((function(t){e.shopCategoryList=t.results})),this.shopAreaListService$.getShopAreaList().subscribe((function(t){e.shopAreaList=t.results}))}},{key:"initMapBox",value:function(){this.map=new c.Map({container:"mapa-mapbox",style:this.streetsMapStyle,center:[104.9001643,11.5447752],bearing:0,zoom:11}),this.originalMarker.setLngLat([104.9001643,11.5447752]).addTo(this.map)}},{key:"markerAllShopLocation",value:function(e){var t=this;e.code.every((function(o,a,r){return t.creatMarkerByShop({name:e.name[a],code:e.code[a],latitude:e.latitude[a],longitude:e.longitude[a],shopCategoryColor:e.shop_category__color[a],shopAreaColor:e.shop_area__color[a],shopLevelColor:e.shopLevel__color[a],shopCityColor:e.city__color[a],shopSellColor:e.sell_color[a],shopNewOrderColor:e.new_order_color[a]},t.colorType),!0}))}},{key:"creatMarkerByShop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"area",o=document.createElement("div");switch(o.className="marker1",o.style.width="18px",o.style.height="18px",o.style.borderRadius="9px",o.style.backgroundImage="circle-15.svg",o.align="center",t){case"category":this.colorText=this.translate.instant("map-pd.category_of_shop"),o.style.backgroundColor=e.shopCategoryColor;break;case"area":this.colorText=this.translate.instant("map-pd.area_of_shop"),o.style.backgroundColor=e.shopAreaColor;break;case"level":this.colorText=this.translate.instant("map-pd.level_of_shop"),o.style.backgroundColor=e.shopLevelColor;break;case"sell":this.colorText=this.translate.instant("map-pd.have_cargo"),o.style.backgroundColor=e.shopSellColor;break;case"new_order":this.colorText=this.translate.instant("map-pd.new_order"),o.style.backgroundColor=e.shopNewOrderColor;break;case"city":this.colorText=this.translate.instant("map-pd.city_of_shop"),o.style.backgroundColor=e.shopCityColor;break;default:o.style.backgroundColor=e.shopAreaColor}var a=new c.Popup({offset:25}).setText(e.name+e.code),r=new c.Marker({element:o,draggable:!1,color:"blue"}).setLngLat([e.longitude,e.latitude]).setPopup(a).addTo(this.map);this.shopMarkers.push(r),o.addEventListener("click",(function(){}))}},{key:"switchLayer",value:function(e){this.map.setStyle(e),console.log(e)}},{key:"getUserLocation",value:function(){var e=this;navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){e.locationMarker.setLngLat([t.coords.longitude,t.coords.latitude]),e.creatUserLocationMarker()})):alert("\u7528\u6237\u4e0d\u5141\u8bb8\u83b7\u53d6\u624b\u673a\u5b9a\u4f4d")}},{key:"creatUserLocationMarker",value:function(){var e=this;this.locationMarker.addTo(this.map),this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat]),this.timer=setInterval((function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(t){e.locationMarker.remove(),e.locationMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(e.map)}))}),1e3)}},{key:"ngOnDestroy",value:function(){this.timer&&clearInterval(this.timer)}},{key:"resetBearing",value:function(){this.map.setBearing(0)}},{key:"resetLocation",value:function(){this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat])}},{key:"refreshShop",value:function(e){var t=this;this.colorType=e,this.selectedMarker.remove(),this.shopService.getPdShopSellCountList().subscribe((function(e){t.removeShopMarker(),t.pdShopList=e.results,t.hidden=!1,t.markerAllShopLocation(t.pdShopList)}))}},{key:"removeShopMarker",value:function(){this.shopMarkers.forEach((function(e){return e.remove()})),this.shopMarkers=[]}}])&&t(a.prototype,r),n&&t(a,n),o}(),n.\u0275fac=function(e){return new(e||n)(p.Ib(h.a),p.Ib(d.a),p.Ib(u.a),p.Ib(g.B),p.Ib(y.d))},n.\u0275cmp=p.Cb({type:n,selectors:[["app-map"]],decls:55,vars:43,consts:[["slot","start"],["autoHide","false","color","danger"],["id","mapa-mapbox"],["id","menu",3,"hidden"],["id","streets-v11","type","radio","name","rtoggle","value","streets","checked","checked",3,"change"],["for","streets-v11"],["id","light-v10","type","radio","name","rtoggle","value","light",3,"change"],["for","light-v10"],["id","dark-v10","type","radio","name","rtoggle","value","dark",3,"change"],["for","dark-v10"],["id","outdoors-v11","type","radio","name","rtoggle","value","outdoors",3,"change"],["for","outdoors-v11"],["id","satellite-v9","type","radio","name","rtoggle","value","satellite",3,"change"],["for","satellite-v9"],["id","bearing",3,"hidden"],[3,"click"],["id","location",3,"hidden"],["name","compass"]],template:function(e,t){1&e&&(p.Lb(0,"ion-header"),p.Lb(1,"ion-toolbar"),p.Lb(2,"ion-buttons",0),p.Jb(3,"ion-menu-button",1),p.Kb(),p.Lb(4,"ion-title"),p.dc(5),p.Ub(6,"translate"),p.Kb(),p.Kb(),p.Kb(),p.Lb(7,"ion-content"),p.Jb(8,"div",2),p.Lb(9,"div",3),p.Lb(10,"input",4),p.Sb("change",(function(){return t.switchLayer(t.streetsMapStyle)})),p.Kb(),p.Lb(11,"label",5),p.dc(12),p.Ub(13,"translate"),p.Kb(),p.Lb(14,"input",6),p.Sb("change",(function(){return t.switchLayer(t.lightMapStyle)})),p.Kb(),p.Lb(15,"label",7),p.dc(16),p.Ub(17,"translate"),p.Kb(),p.Lb(18,"input",8),p.Sb("change",(function(){return t.switchLayer(t.darkMapStyle)})),p.Kb(),p.Lb(19,"label",9),p.dc(20),p.Ub(21,"translate"),p.Kb(),p.Lb(22,"input",10),p.Sb("change",(function(){return t.switchLayer(t.outdoorsMapStyle)})),p.Kb(),p.Lb(23,"label",11),p.dc(24),p.Ub(25,"translate"),p.Kb(),p.Lb(26,"input",12),p.Sb("change",(function(){return t.switchLayer(t.satelliteMapStyle)})),p.Kb(),p.Lb(27,"label",13),p.dc(28),p.Ub(29,"translate"),p.Kb(),p.Kb(),p.Lb(30,"div",14),p.Lb(31,"ion-fab-button",15),p.Sb("click",(function(){return t.resetBearing()})),p.dc(32),p.Ub(33,"translate"),p.Kb(),p.Kb(),p.Lb(34,"div",16),p.Lb(35,"ion-fab-button",15),p.Sb("click",(function(){return t.resetLocation()})),p.Jb(36,"ion-icon",17),p.Kb(),p.Lb(37,"ion-button",15),p.Sb("click",(function(){return t.refreshShop("category")})),p.dc(38),p.Ub(39,"translate"),p.Kb(),p.Lb(40,"ion-button",15),p.Sb("click",(function(){return t.refreshShop("area")})),p.dc(41),p.Ub(42,"translate"),p.Kb(),p.Lb(43,"ion-button",15),p.Sb("click",(function(){return t.refreshShop("city")})),p.dc(44),p.Ub(45,"translate"),p.Kb(),p.Lb(46,"ion-button",15),p.Sb("click",(function(){return t.refreshShop("level")})),p.dc(47),p.Ub(48,"translate"),p.Kb(),p.Lb(49,"ion-button",15),p.Sb("click",(function(){return t.refreshShop("sell")})),p.dc(50),p.Ub(51,"translate"),p.Kb(),p.Lb(52,"ion-button",15),p.Sb("click",(function(){return t.refreshShop("new_order")})),p.dc(53),p.Ub(54,"translate"),p.Kb(),p.Kb(),p.Kb()),2&e&&(p.yb(5),p.gc("",p.Vb(6,17,"map-pd. area_of_all_shop"),"--\uff08",t.colorText,"\uff09"),p.yb(4),p.Yb("hidden",t.hidden),p.yb(3),p.ec(p.Vb(13,19,"map-pd.street")),p.yb(4),p.ec(p.Vb(17,21,"map-pd.light")),p.yb(4),p.ec(p.Vb(21,23,"map-pd.dark")),p.yb(4),p.ec(p.Vb(25,25,"map-pd.outdoors")),p.yb(4),p.ec(p.Vb(29,27,"map-pd.satellite")),p.yb(2),p.Yb("hidden",t.hidden),p.yb(2),p.ec(p.Vb(33,29,"map-pd.north")),p.yb(2),p.Yb("hidden",t.hidden),p.yb(4),p.ec(p.Vb(39,31,"map-pd.category")),p.yb(3),p.ec(p.Vb(42,33,"map-pd.area")),p.yb(3),p.ec(p.Vb(45,35,"map-pd.city")),p.yb(3),p.ec(p.Vb(48,37,"map-pd.level")),p.yb(3),p.ec(p.Vb(51,39,"map-pd.have_cargo")),p.yb(3),p.ec(p.Vb(54,41,"map-pd.new_order")))},directives:[g.h,g.y,g.d,g.o,g.w,g.f,g.g,g.i,g.c],pipes:[y.c],styles:["#mapa-mapbox[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%;height:100%}#menu[_ngcontent-%COMP%]{background:#fff;padding:10px;font-family:Open Sans,sans-serif}#bearing[_ngcontent-%COMP%], #menu[_ngcontent-%COMP%]{position:absolute}#bearing[_ngcontent-%COMP%]{margin-top:300px}#location[_ngcontent-%COMP%]{position:absolute;margin-top:400px}.my-custom-class[_ngcontent-%COMP%]{--background:#222}"]}),n)}],f=((i=function t(){e(this,t)}).\u0275mod=p.Gb({type:i}),i.\u0275inj=p.Fb({factory:function(e){return new(e||i)},imports:[[l.i.forChild(m)],l.i]}),i),k=r("kCW2"),v=((s=function t(){e(this,t)}).\u0275mod=p.Gb({type:s}),s.\u0275inj=p.Fb({factory:function(e){return new(e||s)},imports:[[k.a,f]]}),s)}}])}();