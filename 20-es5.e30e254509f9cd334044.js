!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{H4Gf:function(o,r,a){"use strict";a.r(r),a.d(r,"MapPageModule",(function(){return L}));var n,i,s,c=a("tyNb"),l=a("mrSG"),u=a("4ZJM"),h=a("AytR"),p=a("LLYR"),d=a("fXoL"),b=a("1jKG"),g=a("njxG"),y=a("WC10"),m=a("TEn/"),f=[{path:"",component:(n=function(){function o(t,r,a,n){e(this,o),this.shopService=t,this.shopCategoryListService$=r,this.shopAreaListService$=a,this.modalController=n,this.colorType="area",this.shopMarkers=[],this.pageSize=1e4,this.pageIndex=1,this.hidden=!0,this.originalMarker=new u.Marker({draggable:!1,color:"blue"}),this.locationMarker=new u.Marker({draggable:!0,color:"blue"}),this.selectedMarker=new u.Marker({draggable:!0,color:"red"}),this.streetsMapStyle="mapbox://styles/mapbox/streets-v11",this.satelliteMapStyle="mapbox://styles/mapbox/satellite-v9",this.lightMapStyle="mapbox://styles/mapbox/light-v10",this.darkMapStyle="mapbox://styles/mapbox/dark-v10",this.outdoorsMapStyle="mapbox://styles/mapbox/outdoors-v11"}var r,a,n;return r=o,(a=[{key:"ngOnInit",value:function(){}},{key:"ionViewWillEnter",value:function(){var e=this;u.accessToken=h.a.mapboxKey,this.shopService.getShopDryList().subscribe((function(t){e.shopDryList=t.results})),this.shopService.getPdShopList().subscribe((function(t){e.pdShopList=t.results,e.initMapBox(),e.mapLoad(),e.hidden=!1,e.mapClick(),e.length=t.count})),this.shopCategoryListService$.getShopCategoryList().subscribe((function(t){e.shopCategoryList=t.results})),this.shopAreaListService$.getShopAreaList().subscribe((function(t){e.shopAreaList=t.results}))}},{key:"initMapBox",value:function(){this.map=new u.Map({container:"mapa-mapbox",style:this.streetsMapStyle,center:[-122.49378204345702,37.83368330777276],bearing:0,zoom:15})}},{key:"mapClick",value:function(){var e=this;this.map.on("touchend",(function(t){e.selectedMarker.remove(),e.selectedMarker.setLngLat(t.lngLat).addTo(e.map),e.presentModal().then()}))}},{key:"markerAllShopLocation",value:function(e){var t=this;e.name.every((function(o,r,a){return t.creatMarkerByShop({name:o,code:e.code[r],latitude:e.latitude[r],longitude:e.longitude[r],shopCategoryColor:e.shop_category__color[r],shopAreaColor:e.shop_area__color[r],shopLevelColor:e.shopLevel__color[r],shopCityColor:e.city__color[r]},t.colorType),!0}))}},{key:"creatMarkerByShop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"area",o=document.createElement("div");switch(o.className="marker1",o.style.width="18px",o.style.height="18px",o.style.borderRadius="9px",o.style.backgroundImage="circle-15.svg",o.align="center",t){case"category":o.style.backgroundColor=e.shopCategoryColor;break;case"area":o.style.backgroundColor=e.shopAreaColor;break;case"level":o.style.backgroundColor=e.shopLevelColor;break;default:o.style.backgroundColor=e.shopAreaColor}var r=new u.Popup({offset:25}).setText(e.name+e.code),a=new u.Marker({element:o,draggable:!1,color:"blue"}).setLngLat([e.longitude,e.latitude]).setPopup(r).addTo(this.map);this.shopMarkers.push(a),o.addEventListener("click",(function(){}))}},{key:"switchLayer",value:function(e){this.map.setStyle(e),console.log(e)}},{key:"getUserLocation",value:function(){var e=this;navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){e.locationMarker.setLngLat([t.coords.longitude,t.coords.latitude]),e.creatUserLocationMarker()})):alert("\u7528\u6237\u4e0d\u5141\u8bb8\u83b7\u53d6\u624b\u673a\u5b9a\u4f4d")}},{key:"creatUserLocationMarker",value:function(){var e=this;this.locationMarker.addTo(this.map),this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat]),this.timer=setInterval((function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(t){e.locationMarker.remove(),e.locationMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(e.map)}))}),1e3)}},{key:"ngOnDestroy",value:function(){this.timer&&clearInterval(this.timer)}},{key:"resetBearing",value:function(){this.map.setBearing(0)}},{key:"resetLocation",value:function(){this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat])}},{key:"presentModal",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,o,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:p.a,cssClass:"my-custom-class",componentProps:{shopCategoryList:this.shopCategoryList,shopAreaList:this.shopAreaList,selectedMarker:this.selectedMarker}});case 2:return t=e.sent,e.next=5,t.present();case 5:return e.next=7,t.onDidDismiss();case 7:(o=e.sent).data.shop&&this.shopService.getShopList(1,1,"","",o.data.shop.code).subscribe((function(e){r.shopAdd=e.results[0],r.creatMarkerByShop(r.shopAdd)}));case 9:case"end":return e.stop()}}),e,this)})))}},{key:"refreshShop",value:function(e){var t=this;this.colorType=e,this.selectedMarker.remove(),this.shopService.getPdShopList().subscribe((function(e){t.removeShopMarker(),t.pdShopList=e.results,t.hidden=!1,t.markerAllShopLocation(t.pdShopList)}))}},{key:"removeShopMarker",value:function(){this.shopMarkers.forEach((function(e){return e.remove()})),this.shopMarkers=[]}},{key:"mapLoad",value:function(){var e=this;this.map.on("load",(function(){e.map.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[-122.48369693756104,37.83381888486939],[-122.48348236083984,37.83317489144141],[-122.48339653015138,37.83270036637107],[-122.48356819152832,37.832056363179625],[-122.48404026031496,37.83114119107971],[-122.48404026031496,37.83049717427869],[-122.48348236083984,37.829920943955045],[-122.48356819152832,37.82954808664175],[-122.48507022857666,37.82944639795659],[-122.48610019683838,37.82880236636284],[-122.48695850372314,37.82931081282506],[-122.48700141906738,37.83080223556934],[-122.48751640319824,37.83168351665737],[-122.48803138732912,37.832158048267786],[-122.48888969421387,37.83297152392784],[-122.48987674713133,37.83263257682617],[-122.49043464660643,37.832937629287755],[-122.49125003814696,37.832429207817725],[-122.49163627624512,37.832564787218985],[-122.49223709106445,37.83337825839438],[-122.49378204345702,37.83368330777276]]}}}),e.map.addLayer({id:"route",type:"circle",source:"route",paint:{"circle-radius":10,"circle-opacity":.5,"circle-stroke-width":2,"circle-stroke-color":"red","circle-stroke-opacity":1}})}))}}])&&t(r.prototype,a),n&&t(r,n),o}(),n.\u0275fac=function(e){return new(e||n)(d.Ib(b.a),d.Ib(g.a),d.Ib(y.a),d.Ib(m.B))},n.\u0275cmp=d.Cb({type:n,selectors:[["app-map"]],decls:36,vars:3,consts:[["slot","start"],["autoHide","false","color","danger"],["id","mapa-mapbox"],["id","menu",3,"hidden"],["id","streets-v11","type","radio","name","rtoggle","value","streets","checked","checked",3,"change"],["for","streets-v11"],["id","light-v10","type","radio","name","rtoggle","value","light",3,"change"],["for","light-v10"],["id","dark-v10","type","radio","name","rtoggle","value","dark",3,"change"],["for","dark-v10"],["id","outdoors-v11","type","radio","name","rtoggle","value","outdoors",3,"change"],["for","outdoors-v11"],["id","satellite-v9","type","radio","name","rtoggle","value","satellite",3,"change"],["for","satellite-v9"],["id","bearing",3,"hidden"],[3,"click"],["id","location",3,"hidden"],["name","compass"]],template:function(e,t){1&e&&(d.Lb(0,"ion-header"),d.Lb(1,"ion-toolbar"),d.Lb(2,"ion-buttons",0),d.Jb(3,"ion-menu-button",1),d.Kb(),d.Lb(4,"ion-title"),d.dc(5,"\u6240\u6709\u5e97\u94fa\u5206\u5e03"),d.Kb(),d.Kb(),d.Kb(),d.Lb(6,"ion-content"),d.Jb(7,"div",2),d.Lb(8,"div",3),d.Lb(9,"input",4),d.Sb("change",(function(){return t.switchLayer(t.streetsMapStyle)})),d.Kb(),d.Lb(10,"label",5),d.dc(11,"streets"),d.Kb(),d.Lb(12,"input",6),d.Sb("change",(function(){return t.switchLayer(t.lightMapStyle)})),d.Kb(),d.Lb(13,"label",7),d.dc(14,"light"),d.Kb(),d.Lb(15,"input",8),d.Sb("change",(function(){return t.switchLayer(t.darkMapStyle)})),d.Kb(),d.Lb(16,"label",9),d.dc(17,"dark"),d.Kb(),d.Lb(18,"input",10),d.Sb("change",(function(){return t.switchLayer(t.outdoorsMapStyle)})),d.Kb(),d.Lb(19,"label",11),d.dc(20,"outdoors"),d.Kb(),d.Lb(21,"input",12),d.Sb("change",(function(){return t.switchLayer(t.satelliteMapStyle)})),d.Kb(),d.Lb(22,"label",13),d.dc(23,"satellite"),d.Kb(),d.Kb(),d.Lb(24,"div",14),d.Lb(25,"ion-fab-button",15),d.Sb("click",(function(){return t.resetBearing()})),d.dc(26,"\u5317"),d.Kb(),d.Kb(),d.Lb(27,"div",16),d.Lb(28,"ion-fab-button",15),d.Sb("click",(function(){return t.resetLocation()})),d.Jb(29,"ion-icon",17),d.Kb(),d.Lb(30,"ion-button",15),d.Sb("click",(function(){return t.refreshShop("category")})),d.dc(31,"\u7c7b\u578b"),d.Kb(),d.Lb(32,"ion-button",15),d.Sb("click",(function(){return t.refreshShop("area")})),d.dc(33,"\u533a\u57df"),d.Kb(),d.Lb(34,"ion-button",15),d.Sb("click",(function(){return t.refreshShop("level")})),d.dc(35,"\u7ea7\u522b"),d.Kb(),d.Kb(),d.Kb()),2&e&&(d.yb(8),d.Yb("hidden",t.hidden),d.yb(16),d.Yb("hidden",t.hidden),d.yb(3),d.Yb("hidden",t.hidden))},directives:[m.h,m.y,m.d,m.o,m.w,m.f,m.g,m.i,m.c],styles:["#mapa-mapbox[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%;height:100%}#menu[_ngcontent-%COMP%]{background:#fff;padding:10px;font-family:Open Sans,sans-serif}#bearing[_ngcontent-%COMP%], #menu[_ngcontent-%COMP%]{position:absolute}#bearing[_ngcontent-%COMP%]{margin-top:300px}#location[_ngcontent-%COMP%]{position:absolute;margin-top:400px}.my-custom-class[_ngcontent-%COMP%]{--background:#222}"]}),n)}],v=((i=function t(){e(this,t)}).\u0275mod=d.Gb({type:i}),i.\u0275inj=d.Fb({factory:function(e){return new(e||i)},imports:[[c.i.forChild(f)],c.i]}),i),k=a("kCW2"),L=((s=function t(){e(this,t)}).\u0275mod=d.Gb({type:s}),s.\u0275inj=d.Fb({factory:function(e){return new(e||s)},imports:[[k.a,v]]}),s)}}])}();