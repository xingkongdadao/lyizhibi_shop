(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{tCC3:function(e,t,o){"use strict";o.r(t),o.d(t,"MapPageModule",(function(){return u}));var a=o("tyNb"),r=o("4ZJM"),s=o("AytR"),i=o("fXoL"),n=o("1jKG"),l=o("njxG"),c=o("WC10"),b=o("TEn/"),h=o("sYmb");const p=[{path:"",component:(()=>{class e{constructor(e,t,o,a,s){this.shopService=e,this.shopCategoryListService$=t,this.shopAreaListService$=o,this.modalController=a,this.translate=s,this.colorType="area",this.shopMarkers=[],this.pageSize=1e4,this.pageIndex=1,this.hidden=!0,this.originalMarker=new r.Marker({draggable:!1,color:"blue"}),this.locationMarker=new r.Marker({draggable:!0,color:"blue"}),this.selectedMarker=new r.Marker({draggable:!0,color:"red"}),this.streetsMapStyle="mapbox://styles/mapbox/streets-v11",this.satelliteMapStyle="mapbox://styles/mapbox/satellite-v9",this.lightMapStyle="mapbox://styles/mapbox/light-v10",this.darkMapStyle="mapbox://styles/mapbox/dark-v10",this.outdoorsMapStyle="mapbox://styles/mapbox/outdoors-v11"}ngOnInit(){r.accessToken=s.a.mapboxKey,this.shopService.getPdShopSellCountList().subscribe(e=>{this.pdShopList=e.results,this.hidden=!1,this.initMapBox(),this.originalMarker.remove(),this.getUserLocation(),this.length=e.count,this.removeShopMarker(),this.markerAllShopLocation(this.pdShopList)}),this.shopCategoryListService$.getShopCategoryList().subscribe(e=>{this.shopCategoryList=e.results}),this.shopAreaListService$.getShopAreaList().subscribe(e=>{this.shopAreaList=e.results})}initMapBox(){this.map=new r.Map({container:"mapa-mapbox",style:this.streetsMapStyle,center:[104.9001643,11.5447752],bearing:0,zoom:11}),this.originalMarker.setLngLat([104.9001643,11.5447752]).addTo(this.map)}markerAllShopLocation(e){e.code.every((t,o,a)=>(this.creatMarkerByShop({name:e.name[o],code:e.code[o],latitude:e.latitude[o],longitude:e.longitude[o],shopCategoryColor:e.shop_category__color[o],shopAreaColor:e.shop_area__color[o],shopLevelColor:e.shopLevel__color[o],shopCityColor:e.city__color[o],shopSellColor:e.sell_color[o],shopNewOrderColor:e.new_order_color[o]},this.colorType),!0))}creatMarkerByShop(e,t="area"){const o=document.createElement("div");switch(o.className="marker1",o.style.width="18px",o.style.height="18px",o.style.borderRadius="9px",o.style.backgroundImage="circle-15.svg",o.align="center",t){case"category":this.colorText=this.translate.instant("map-pd.category_of_shop"),o.style.backgroundColor=e.shopCategoryColor;break;case"area":this.colorText=this.translate.instant("map-pd.area_of_shop"),o.style.backgroundColor=e.shopAreaColor;break;case"level":this.colorText=this.translate.instant("map-pd.level_of_shop"),o.style.backgroundColor=e.shopLevelColor;break;case"sell":this.colorText=this.translate.instant("map-pd.have_cargo"),o.style.backgroundColor=e.shopSellColor;break;case"new_order":this.colorText=this.translate.instant("map-pd.new_order"),o.style.backgroundColor=e.shopNewOrderColor;break;case"city":this.colorText=this.translate.instant("map-pd.city_of_shop"),o.style.backgroundColor=e.shopCityColor;break;default:o.style.backgroundColor=e.shopAreaColor}const a=new r.Popup({offset:25}).setText(e.name+e.code),s=new r.Marker({element:o,draggable:!1,color:"blue"}).setLngLat([e.longitude,e.latitude]).setPopup(a).addTo(this.map);this.shopMarkers.push(s),o.addEventListener("click",()=>{})}switchLayer(e){this.map.setStyle(e),console.log(e)}getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{this.locationMarker.setLngLat([e.coords.longitude,e.coords.latitude]),this.creatUserLocationMarker()}):alert("\u7528\u6237\u4e0d\u5141\u8bb8\u83b7\u53d6\u624b\u673a\u5b9a\u4f4d")}creatUserLocationMarker(){this.locationMarker.addTo(this.map),this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat]),this.timer=setInterval(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{this.locationMarker.remove(),this.locationMarker.setLngLat([e.coords.longitude,e.coords.latitude]).addTo(this.map)})},1e3)}ngOnDestroy(){this.timer&&clearInterval(this.timer)}resetBearing(){this.map.setBearing(0)}resetLocation(){this.map.setCenter([this.locationMarker.getLngLat().lng,this.locationMarker.getLngLat().lat])}refreshShop(e){this.colorType=e,this.selectedMarker.remove(),this.shopService.getPdShopSellCountList().subscribe(e=>{this.removeShopMarker(),this.pdShopList=e.results,this.hidden=!1,this.markerAllShopLocation(this.pdShopList)})}removeShopMarker(){this.shopMarkers.forEach(e=>e.remove()),this.shopMarkers=[]}}return e.\u0275fac=function(t){return new(t||e)(i.Ib(n.a),i.Ib(l.a),i.Ib(c.a),i.Ib(b.B),i.Ib(h.d))},e.\u0275cmp=i.Cb({type:e,selectors:[["app-map"]],decls:55,vars:43,consts:[["slot","start"],["autoHide","false","color","danger"],["id","mapa-mapbox"],["id","menu",3,"hidden"],["id","streets-v11","type","radio","name","rtoggle","value","streets","checked","checked",3,"change"],["for","streets-v11"],["id","light-v10","type","radio","name","rtoggle","value","light",3,"change"],["for","light-v10"],["id","dark-v10","type","radio","name","rtoggle","value","dark",3,"change"],["for","dark-v10"],["id","outdoors-v11","type","radio","name","rtoggle","value","outdoors",3,"change"],["for","outdoors-v11"],["id","satellite-v9","type","radio","name","rtoggle","value","satellite",3,"change"],["for","satellite-v9"],["id","bearing",3,"hidden"],[3,"click"],["id","location",3,"hidden"],["name","compass"]],template:function(e,t){1&e&&(i.Lb(0,"ion-header"),i.Lb(1,"ion-toolbar"),i.Lb(2,"ion-buttons",0),i.Jb(3,"ion-menu-button",1),i.Kb(),i.Lb(4,"ion-title"),i.dc(5),i.Ub(6,"translate"),i.Kb(),i.Kb(),i.Kb(),i.Lb(7,"ion-content"),i.Jb(8,"div",2),i.Lb(9,"div",3),i.Lb(10,"input",4),i.Sb("change",(function(){return t.switchLayer(t.streetsMapStyle)})),i.Kb(),i.Lb(11,"label",5),i.dc(12),i.Ub(13,"translate"),i.Kb(),i.Lb(14,"input",6),i.Sb("change",(function(){return t.switchLayer(t.lightMapStyle)})),i.Kb(),i.Lb(15,"label",7),i.dc(16),i.Ub(17,"translate"),i.Kb(),i.Lb(18,"input",8),i.Sb("change",(function(){return t.switchLayer(t.darkMapStyle)})),i.Kb(),i.Lb(19,"label",9),i.dc(20),i.Ub(21,"translate"),i.Kb(),i.Lb(22,"input",10),i.Sb("change",(function(){return t.switchLayer(t.outdoorsMapStyle)})),i.Kb(),i.Lb(23,"label",11),i.dc(24),i.Ub(25,"translate"),i.Kb(),i.Lb(26,"input",12),i.Sb("change",(function(){return t.switchLayer(t.satelliteMapStyle)})),i.Kb(),i.Lb(27,"label",13),i.dc(28),i.Ub(29,"translate"),i.Kb(),i.Kb(),i.Lb(30,"div",14),i.Lb(31,"ion-fab-button",15),i.Sb("click",(function(){return t.resetBearing()})),i.dc(32),i.Ub(33,"translate"),i.Kb(),i.Kb(),i.Lb(34,"div",16),i.Lb(35,"ion-fab-button",15),i.Sb("click",(function(){return t.resetLocation()})),i.Jb(36,"ion-icon",17),i.Kb(),i.Lb(37,"ion-button",15),i.Sb("click",(function(){return t.refreshShop("category")})),i.dc(38),i.Ub(39,"translate"),i.Kb(),i.Lb(40,"ion-button",15),i.Sb("click",(function(){return t.refreshShop("area")})),i.dc(41),i.Ub(42,"translate"),i.Kb(),i.Lb(43,"ion-button",15),i.Sb("click",(function(){return t.refreshShop("city")})),i.dc(44),i.Ub(45,"translate"),i.Kb(),i.Lb(46,"ion-button",15),i.Sb("click",(function(){return t.refreshShop("level")})),i.dc(47),i.Ub(48,"translate"),i.Kb(),i.Lb(49,"ion-button",15),i.Sb("click",(function(){return t.refreshShop("sell")})),i.dc(50),i.Ub(51,"translate"),i.Kb(),i.Lb(52,"ion-button",15),i.Sb("click",(function(){return t.refreshShop("new_order")})),i.dc(53),i.Ub(54,"translate"),i.Kb(),i.Kb(),i.Kb()),2&e&&(i.yb(5),i.gc("",i.Vb(6,17,"map-pd. area_of_all_shop"),"--\uff08",t.colorText,"\uff09"),i.yb(4),i.Yb("hidden",t.hidden),i.yb(3),i.ec(i.Vb(13,19,"map-pd.street")),i.yb(4),i.ec(i.Vb(17,21,"map-pd.light")),i.yb(4),i.ec(i.Vb(21,23,"map-pd.dark")),i.yb(4),i.ec(i.Vb(25,25,"map-pd.outdoors")),i.yb(4),i.ec(i.Vb(29,27,"map-pd.satellite")),i.yb(2),i.Yb("hidden",t.hidden),i.yb(2),i.ec(i.Vb(33,29,"map-pd.north")),i.yb(2),i.Yb("hidden",t.hidden),i.yb(4),i.ec(i.Vb(39,31,"map-pd.category")),i.yb(3),i.ec(i.Vb(42,33,"map-pd.area")),i.yb(3),i.ec(i.Vb(45,35,"map-pd.city")),i.yb(3),i.ec(i.Vb(48,37,"map-pd.level")),i.yb(3),i.ec(i.Vb(51,39,"map-pd.have_cargo")),i.yb(3),i.ec(i.Vb(54,41,"map-pd.new_order")))},directives:[b.h,b.y,b.d,b.o,b.w,b.f,b.g,b.i,b.c],pipes:[h.c],styles:["#mapa-mapbox[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%;height:100%}#menu[_ngcontent-%COMP%]{background:#fff;padding:10px;font-family:Open Sans,sans-serif}#bearing[_ngcontent-%COMP%], #menu[_ngcontent-%COMP%]{position:absolute}#bearing[_ngcontent-%COMP%]{margin-top:300px}#location[_ngcontent-%COMP%]{position:absolute;margin-top:400px}.my-custom-class[_ngcontent-%COMP%]{--background:#222}"]}),e})()}];let d=(()=>{class e{}return e.\u0275mod=i.Gb({type:e}),e.\u0275inj=i.Fb({factory:function(t){return new(t||e)},imports:[[a.i.forChild(p)],a.i]}),e})();var g=o("kCW2");let u=(()=>{class e{}return e.\u0275mod=i.Gb({type:e}),e.\u0275inj=i.Fb({factory:function(t){return new(t||e)},imports:[[g.a,d]]}),e})()}}]);